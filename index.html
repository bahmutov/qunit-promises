<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>QUnit Promises Assertions Example</title>
  <link rel="stylesheet" href="http://code.jquery.com/qunit/qunit-1.12.0.css">
</head>
<body>
  <a href="https://github.com/bahmutov/qunit-promises"><img style="position: fixed; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"
  title="Fork me on GitHub - qunit-promises"></a>

  <h2>A convenient way to deal with promises in QUnit.</h2>

  <div id="qunit"></div>
  <div id="qunit-fixture"></div>
  <!-- for deferred -->
  <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
  <script src="http://code.jquery.com/qunit/qunit-1.12.0.js"></script>
  <script src="qunit-promises.js"></script>

  <script>
  function delayedHello() {
    var deferred = new $.Deferred();
    setTimeout(function () { deferred.resolve('hello'); }, 100);
    return deferred.promise();
  }

  function delayedHelloFail() {
    var deferred = new $.Deferred();
    setTimeout(function () { deferred.reject('bye'); }, 100);
    return deferred.promise();
  }

  function delayedOne() {
    var deferred = new $.Deferred();
    setTimeout(function () { deferred.resolve(1); }, 100);
    return deferred.promise();
  }

  function delayedOneFail() {
    var deferred = new $.Deferred();
    setTimeout(function () { deferred.reject(1); }, 100);
    return deferred.promise();
  }

  // regular custom code testing a successful promise
  QUnit.asyncTest("test successful promise", 1, function (assert) {
    var promise = delayedHello();
    promise.then(function (actual) {
      assert.equal(actual, 'hello', 'promise resolved with "hello"');
    }).always(start);
  });

  // qunit-promises assertion
  QUnit.asyncTest("promise will resolve", 1, function (assert) {
    assert.will(delayedHello());
  });

  QUnit.asyncTest("promise will resolve with message", 1, function (assert) {
    assert.will(delayedHello(), 'the promise is ok');
  });

  QUnit.asyncTest("promise will resolve with value", 1, function (assert) {
    assert.willEqual(delayedHello(), 'hello', 'returns "hello"');
  });

  QUnit.asyncTest("compare value using deep equality", 1, function (assert) {
    assert.willEqual(delayedOne(), 1, 'returns 1');
  });

  // regular code to test failed promise
  QUnit.asyncTest("test failed promise", 1, function (assert) {
    var promise = delayedHelloFail();
    promise.then(function () {
      assert.ok(false, 'promise failed to fail!');
    }, function (actual) {
      assert.equal(actual, 'bye', 'promise failed');
    }).always(start);
  });

  QUnit.asyncTest("promise will reject", 1, function (assert) {
    assert.wont(delayedHelloFail(), 'promise fails');
  });

  QUnit.asyncTest("promise will reject with value", 1, function (assert) {
    assert.wontEqual(delayedHelloFail(), 'bye');
  });

  QUnit.asyncTest("promise will reject with value + message", 1, function (assert) {
    assert.wontEqual(delayedHelloFail(), 'bye', 'this is failed promise');
  });

  QUnit.asyncTest("using deep equality", 1, function (assert) {
    assert.wontEqual(delayedOneFail(), 1, 'returns 1');
  });


  // advanced
  QUnit.asyncTest("two resolved promises in sequence", 1, function (assert) {
    assert.willEqual(delayedHello().then(delayedHello), 'hello', 'promises chained');
  });
  </script>
</body>
</html>